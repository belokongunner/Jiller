{% load gravatar %}
{% load i18n %}
{% load thumbnail %}
{% load visible_logs %}

{# block user profile #}
<div class="page-header"><h1>{{ user.get_full_name }}</h1></div>
<div id="user-profile-2" class="user-profile">
  <div class="tabbable">
    <ul class="nav nav-tabs padding-18">
      <li class="active">
        <a data-toggle="tab" href="#home">
          <i class="green ace-icon fa fa-user bigger-120"></i>
          Profile
        </a>
      </li>
      <li>
        <a data-toggle="tab" href="#logs">
          <span class="badge badge-danger">{{ user.issuelog_set.count }}</span>
          Logs
        </a>
      </li>
      <li>
        <a data-toggle="tab" href="#issues">
          <span class="badge badge-danger">{{ user.employee_issue_set.count }}</span>
          Issue
        </a>
      </li>
      <li>
        <a data-toggle="tab" href="#projects">
          <span class="badge badge-danger">{{ user.get_all_projects.count }}</span>
          Projects
        </a>
      </li>
      <li>
        <a data-toggle="tab" href="#comments">
          <span class="badge badge-danger">{{ user.issuecomment_set.count }}</span>
          Comments
        </a>
      </li>
    </ul>

    <div class="tab-content no-border padding-24">
      <div id="home" class="tab-pane in active">
        <div class="row">
          <div class="col-xs-12 col-sm-3 center">
              <span class="profile-picture">
                <img class="editable img-responsive"
                    {% if user.photo %}
                      {% thumbnail user.photo "200x200" crop="center" as im %}
                     src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}"
                      {% endthumbnail %}
                    {% else %}
                     src="{{ user.email|gravatar_url:200 }}"
                    {% endif %}
                />
              </span>
            <div>
              <a href="accounts/social/connections/">Edit social network
                authentications</a>
            </div>
            <div class="space space-4"></div>
          </div>

          <div class="col-xs-12 col-sm-9">
            <div class="profile-user-info">
              <div class="profile-info-row">
                <div class="profile-info-name"> Username</div>
                <div class="profile-info-value">
                  <span>{{ user.username }}</span>
                </div>
              </div>

              <div class="profile-info-row">
                <div class="profile-info-name">Email</div>
                <div class="profile-info-value">
                  <span>{{ user.email }}</span>
                </div>
              </div>

              {% if user.calculate_age %}
                <div class="profile-info-row">
                  <div class="profile-info-name"> Age</div>
                  <div class="profile-info-value">
                    <span>{{ user.calculate_age }}</span>
                  </div>
                </div>
              {% endif %}

              <div class="profile-info-row">
                <div class="profile-info-name"> Joined</div>
                <div class="profile-info-value">
                  <span>{{ user.get_pretty_date_joined }}</span>
                </div>
              </div>

              <div class="profile-info-row">
                {% if user.is_authenticated %}
                  <div class="profile-info-name">Online</div>
                  <div class="profile-info-value">
                  <span>True</span>
                {% else %}
                  <div class="profile-info-name">Last login</div>
                  <div class="profile-info-value">
                  <span>{{ user.last_login }}</span>
                {% endif %}
                </div>
                </div>
              </div>
            </div>
            <div class="hr hr-8 dotted"></div>
          </div>
        </div>
        {# end block user profile #}
        {#block user logs#}

        <div id="logs" class="tab-pane fade">
          <table id="simple-table" class="table  table-bordered table-hover">
            <thead>
            <tr>
              <th>Issue</th>
              <th>Costs</th>
              <th>Note</th>
            </tr>
            </thead>
            <tbody>
            {% for log in user.issuelog_set.all|visible_logs %}
              <tr>
                <td class="col-sm-2">
                  <a href="{% url 'project:issue_detail' log.issue.project.id log.issue.id %}">
                    {{ log.issue.title }}
                  </a>
                </td>
                <td class="col-sm-1"><span>{{ log.cost }}</span></td>
                <td class="col-sm-9"><span>{{ log.note }}</span></td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>

        {# end block user logs #}
        {#block user issue#}

        <div id="issues" class="tab-pane fade">
          <table id="simple-table" class="table  table-bordered table-hover">
            <thead>
            <tr>
              <th>Author</th>
              <th>Title</th>
              <th>Status</th>
              <th>Estimation</th>
              <th>Project</th>
              <th>Sprint</th>
            </tr>
            </thead>
            <tbody>
            {% for issue in user.employee_issue_set.all %}
              <tr>
                <td><a href="{% url 'employee:detail' issue.author.id %}">{{ issue.author }}</a></td>
                <td><a href="{% url 'project:issue_detail' issue.project.id issue.id %}">{{ issue.title }}</a></td>
                <td><span>{{ issue.status }}</span></td>
                <td><span>{{ issue.estimation }}</span></td>
                <td><a href="{% url 'project:detail' issue.project.id %}">{{ issue.project.title }}</a></td>

                <td>
                  {% if issue.sprint %}
                    <a href="{% url 'project:sprint_detail' issue.project.id issue.sprint.id %}">
                      {{ issue.sprint.title }}
                    </a>
                  {% else %}
                    <span>None</span>
                  {% endif %}</td>

              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>

        <div id="projects" class="tab-pane fade">
          <table id="simple-table" class="table  table-bordered table-hover">
            <thead>
            <tr>
              <th>Title</th>
              <th>Start date</th>
              <th>End date</th>
            </tr>
            </thead>
            <tbody>
            {% for project in user.get_all_projects %}
              <tr>
                <td><a href="{% url 'project:detail' project.id %}">{{ project.title }}</a></td>
                <td><span>{{ project.start_date }}</span></td>
                <td><span>{{ project.end_date }}</span></td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>

        <div id="comments" class="tab-pane fade">
          <table id="simple-table" class="table  table-bordered table-hover">
            <thead>
            <tr>
              <th>Issue</th>
              <th>Text</th>
              <th>Date created</th>
            </tr>
            </thead>
            <tbody>
            {% for comment in user.issuecomment_set.all %}
              <tr>
                <td class="col-sm-2">
                  <a href="{% url 'project:issue_detail' comment.issue.project.id comment.issue.id %}">
                    {{ comment.issue.title }}
                  </a>
                </td>
                <td class="col-sm-1"><span>{{ comment.text }}</span></td>
                <td class="col-sm-9"><span>{{ comment.get_pretty_date_created }}</span></td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>